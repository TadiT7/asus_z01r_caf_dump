#!/system/bin/sh

ON="/proc/driver/ois_power"
RDATA="/proc/driver/ois_rdata"
RC="/proc/driver/ois_atd_status"

FILE="/sdcard/gyro.csv"

LOG="/proc/fac_printklog"

function usage()
{
    echo "
API: ATD TestCommand Interface

FORMAT: adb shell /data/data/Camera_OIS_Rdata Para1

USAGE:
    (Para1) recode data numbers
    Example:
		1024 = 1024 numbers of Gyro X/Y, ACC X/Y data and Hall X/Y data
		2048 = 2048 numbers of Gyro X/Y, ACC X/Y data and Hall X/Y data
"
}

function power_on()
{
	echo 1 > $ON
}
function power_off()
{
	echo 0 > $ON
}

function do_process()
{
	echo $1 > $RDATA
}

function cat_status()
{
	cat $RC
}

[ -e $LOG ] && echo "$0 $*"> $LOG


if [ $# -ne 1 ]
then
	echo "0"
	usage
	exit 1
fi

echo $1|grep -Eqi "^[0-9]+$"
rc=$?

if [ $rc -ne 0 ]
then
	echo "0"
	echo "please input legal decimal format value!"
	usage
	exit 1
fi

power_state=$(cat $ON)
if [ $power_state -eq 0 ]
then
	echo "Solo power up..."
	solo=1
	power_on
else
	solo=0
fi


[ -e "$FILE" ] && rm $FILE

do_process $1

cat_status

if [ $solo -eq 1 ]
then
	echo "Solo power down..."
	power_off
fi
